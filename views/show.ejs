<%- include('./partials/header') %>
  <title>Show Route</title>
      <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 90%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
</head>
<body>
  <%- include('./partials/navbar') %>
  <h1>Route Analysis</h1>
  <div id="map"></div>
      <script>
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3,
          center: {lat: 0, lng: -180},
          mapTypeId: 'terrain'
        });
        var flightPlanCoordinates = <%- JSON.stringify(path) %>;
        console.log(JSON.stringify(flightPlanCoordinates));

        var lineSymbol = {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
          strokeColor: '#000'
        };

        var flightPath = new google.maps.Polyline({
          path: flightPlanCoordinates,
          icons: [{
            icon: lineSymbol,
            offset: '100%'
          }],
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
        flightPath.setMap(map);
        animateCircle(flightPath);

        flightPlanCoordinates.forEach(function (latLng, index) {
          let title = (index === 0) ? 'Start' : `Destination ${index}`;
          
          title = (index === flightPlanCoordinates.length - 1) ? 'Final Destination' : title;

          var marker = new google.maps.Marker({
            position: latLng,
            map: map,
            title: title,
          });
        });

        // Use the DOM setInterval() function to change the offset of the symbol
        // at fixed intervals.
        function animateCircle(line) {
          var count = 0;
          window.setInterval(function() {
            count = (count + 1) % 400;

            var icons = line.get('icons');
            icons[0].offset = (count / 4) + '%';
            line.set('icons', icons);
        }, 20);
      }
    }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC3ABfQlr8Nj-T8xLSLcWePhYzA982e87k&callback=initMap">
    </script>
</body>
</html>